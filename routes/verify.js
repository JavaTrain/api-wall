var User = require('../models/user');
var jwt = require('jsonwebtoken'); // used to create, sign, and verify tokens
var config = require('../config.js');

exports.getToken = function (user) {
    return jwt.sign(user, config.secretKey, {
        expiresIn: 360000
    });
};

exports.verifyOrdinaryUser = function (req, res, next) {
    // check header or url parameters or post parameters for token
    var token = req.body.token || req.query.token || req.headers['x-access-token'];

    // decode token
    if (token) {
        // verifies secret and checks exp
        jwt.verify(token, config.secretKey, function (err, decoded) {
            if (err) {
                var err = new Error('You are not authenticated!');
                err.status = 401;
                return next(err);
            } else {
                // if everything is good, save to request for use in other routes
                req.decoded = decoded;
                next();
            }
        });
    } else {
        // if there is no token
        // return an error
        var err = new Error('No token provided!');
        err.status = 403;
        return next(err);
    }
};

exports.verifyAdmin = function(req,res,next){
    next();
};

/*
john token
 eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyIkX18iOnsic3RyaWN0TW9kZSI6dHJ1ZSwic2VsZWN0ZWQiOnt9LCJnZXR0ZXJzIjp7fSwid2FzUG9wdWxhdGVkIjpmYWxzZSwiYWN0aXZlUGF0aHMiOnsicGF0aHMiOnsiZmlyc3RuYW1lIjoiaW5pdCIsImxhc3RuYW1lIjoiaW5pdCIsImFkbWluIjoiaW5pdCIsIl9fdiI6ImluaXQiLCJ1c2VybmFtZSI6ImluaXQiLCJoYXNoIjoiaW5pdCIsInNhbHQiOiJpbml0IiwiY3JlYXRlZEF0IjoiaW5pdCIsInVwZGF0ZWRBdCI6ImluaXQiLCJfaWQiOiJpbml0In0sInN0YXRlcyI6eyJpZ25vcmUiOnt9LCJkZWZhdWx0Ijp7fSwiaW5pdCI6eyJfX3YiOnRydWUsImZpcnN0bmFtZSI6dHJ1ZSwibGFzdG5hbWUiOnRydWUsImFkbWluIjp0cnVlLCJ1c2VybmFtZSI6dHJ1ZSwiaGFzaCI6dHJ1ZSwic2FsdCI6dHJ1ZSwiY3JlYXRlZEF0Ijp0cnVlLCJ1cGRhdGVkQXQiOnRydWUsIl9pZCI6dHJ1ZX0sIm1vZGlmeSI6e30sInJlcXVpcmUiOnt9fSwic3RhdGVOYW1lcyI6WyJyZXF1aXJlIiwibW9kaWZ5IiwiaW5pdCIsImRlZmF1bHQiLCJpZ25vcmUiXX0sImVtaXR0ZXIiOnsiZG9tYWluIjpudWxsLCJfZXZlbnRzIjp7fSwiX2V2ZW50c0NvdW50IjowLCJfbWF4TGlzdGVuZXJzIjowfX0sImlzTmV3IjpmYWxzZSwiX2RvYyI6eyJmaXJzdG5hbWUiOiJKb2huIiwibGFzdG5hbWUiOiJTbWl0aCIsImFkbWluIjp0cnVlLCJfX3YiOjAsInVzZXJuYW1lIjoiam9obiIsImhhc2giOiIwZmI0YTViZDExZWU1ZjFjYTNkNmQ0OTVlODE1MzhhMzAyNzdmN2UxMWViN2M2NTYxNjkyODNmMGRmMmYwYjlkZjc3MmZlZTFkMTJjMDI1NTVhZDM5MDE3ZDdmMzM4NDE0MzI5ZGUzZDlkMDRlNDE4MmU2NGE4OTM1NTI2MzNjM2ZjOGI3MTQzZTc1YmZlZDQzMmIyYjg4MDgwNTI0YjNlMTQ1ZWNiYjZkNTNjMmQ0N2JiYTEzM2EwYWNlNjExZTkzMjBjZmI4MTkyOGUxMjRhODBiMTNjOGUwZTgyZDJjNzVkNjg3YjU4ZmY1NWZkOTBhZjg4ODg4OGEwOTY3ZDgxMjI1N2VjNmI4YTA3YzIzMjhhMjBlNWU0YmUyNGIyNTc0N2JhMTFkZWRhNDhiN2IwZDllNzA2MjJlZWVkYWY1OTEzNTA0ZTZlN2MzNDAwYzMzMjIwYTA5YzI4NjlmNTkxMDZlOWVlOTljYTU4MzQ0ZGFmNWVkZDUwNjAxMGJkMDJhNzFmMmU4YmRjOGY5NDQxYTg1NDUzZTVmMDM0ZDFmZjI2M2QwMTIzNGY4ZmE1OGUyYmNlZGE3ZDY4OGM1NjU0MWIwNjI1OWIxNTAyYjVjMTQ2NmEyMWUyOWZhZGJkMThkODJhYmZlZjIxZDdmZGE2NTI5YzVlZWE0Y2E1MjI3Yjg2MzhiOTc4NTI1MzEyODVhMTU1MWQ1OTU1ZWY3ZjIxMTE2OTY1ZjBkMjcxM2YxMzI4NjNlZjY4YThkOGZkMDBhMDk3YTkzYjg2YmJhODQzYjZmZGMzMjBhODlkZjUwZjk0M2QyOGQ3ZmRiZTE2ZmE2MWU5M2Q3ZjAzOGY0ZWYyN2NiNTdkMDI4YmEyNDM0ZWJhMmU2ZjU0NTMwN2FiYjIwN2I3MDE0MDgxMjE1NGVkZTRlMDQ0ZDEwNmU1NzliMGZkZGE3MDc4YTgxYmE0YmNhNmU0M2U0ZDkwYTc5OWJiOGQwZTllYmM5MGEyYjUzNWFiZjRmNTVmZmE1YmM0NzM1MzA5YjJhMjg1ZDA0NjRiNmU5NThhOWY0OTA5MDVkMTM1NTFkMzk2ODNjZWY3OTkzNjk2NWM3OGEzYzMwNmYxNWQyNTg0MmQ4MzEzYmQ0NDQ5YWQyMTk2YjAwZDkxOTk2MjgyMzQ5ZGEyOTc5MzIyOTZiOTI1YTU2ZjJkNzIxNmEzYmIxOTlkMTg0NDg3NWFmZDU2OGJhYzBlMzI1Zjg0MzA3NGMzNjA4ODk4NDRjMzllODQ3NTcxZTVmYWQ1Y2M3NjQxYjQ2MDJlNDFiOGYzZGE3YTIwMGZiNjRjNmQ1NmNmN2ZkNmQ2ZTdiNGYzOGFmZjIwYjJlMWZkY2E5NTIxIiwic2FsdCI6ImQ3NDY3YTRmZTZiNjU1N2VhMWY3MDFjYjcyMzBmMjVhN2NkMzY2MDhjOTE5YjJhOTEzYWUyN2Q4NjcxYjA3NTIiLCJjcmVhdGVkQXQiOiIyMDE2LTA5LTI1VDE2OjE5OjAwLjczMFoiLCJ1cGRhdGVkQXQiOiIyMDE2LTA5LTI1VDE2OjE5OjAwLjczOVoiLCJfaWQiOiI1N2U3ZjhmNDdkMjhlYTE4M2Y5Y2Y0YTAifSwiX3ByZXMiOnsiJF9fb3JpZ2luYWxfc2F2ZSI6W251bGwsbnVsbCxudWxsLG51bGxdLCIkX19vcmlnaW5hbF92YWxpZGF0ZSI6W251bGxdLCIkX19vcmlnaW5hbF9yZW1vdmUiOltudWxsXX0sIl9wb3N0cyI6eyIkX19vcmlnaW5hbF9zYXZlIjpbXSwiJF9fb3JpZ2luYWxfdmFsaWRhdGUiOltdLCIkX19vcmlnaW5hbF9yZW1vdmUiOltdfSwiaWF0IjoxNDc0ODIwNTY4LCJleHAiOjE0NzQ4MjQxNjh9.WZxKngtumnf6jngeZKnqU-_A5mTNMyMYsZ5Q-YVGUDw
 bob
 eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyIkX18iOnsic3RyaWN0TW9kZSI6dHJ1ZSwic2VsZWN0ZWQiOnt9LCJnZXR0ZXJzIjp7fSwid2FzUG9wdWxhdGVkIjpmYWxzZSwiYWN0aXZlUGF0aHMiOnsicGF0aHMiOnsiZmlyc3RuYW1lIjoiaW5pdCIsImxhc3RuYW1lIjoiaW5pdCIsImFkbWluIjoiaW5pdCIsIl9fdiI6ImluaXQiLCJ1c2VybmFtZSI6ImluaXQiLCJoYXNoIjoiaW5pdCIsInNhbHQiOiJpbml0IiwiY3JlYXRlZEF0IjoiaW5pdCIsInVwZGF0ZWRBdCI6ImluaXQiLCJfaWQiOiJpbml0In0sInN0YXRlcyI6eyJpZ25vcmUiOnt9LCJkZWZhdWx0Ijp7fSwiaW5pdCI6eyJfX3YiOnRydWUsImZpcnN0bmFtZSI6dHJ1ZSwibGFzdG5hbWUiOnRydWUsImFkbWluIjp0cnVlLCJ1c2VybmFtZSI6dHJ1ZSwiaGFzaCI6dHJ1ZSwic2FsdCI6dHJ1ZSwiY3JlYXRlZEF0Ijp0cnVlLCJ1cGRhdGVkQXQiOnRydWUsIl9pZCI6dHJ1ZX0sIm1vZGlmeSI6e30sInJlcXVpcmUiOnt9fSwic3RhdGVOYW1lcyI6WyJyZXF1aXJlIiwibW9kaWZ5IiwiaW5pdCIsImRlZmF1bHQiLCJpZ25vcmUiXX0sImVtaXR0ZXIiOnsiZG9tYWluIjpudWxsLCJfZXZlbnRzIjp7fSwiX2V2ZW50c0NvdW50IjowLCJfbWF4TGlzdGVuZXJzIjowfX0sImlzTmV3IjpmYWxzZSwiX2RvYyI6eyJmaXJzdG5hbWUiOiJCb2IiLCJsYXN0bmFtZSI6IkRpbGFuIiwiYWRtaW4iOmZhbHNlLCJfX3YiOjAsInVzZXJuYW1lIjoiYm9iIiwiaGFzaCI6ImYxZjExOWExMzA0NzVmMTg5MDA3NGIyYjkyNjRhYzBhN2JjMzU0MzYwYmM5NGYwMmY1MzNiZGM2NzkxZjYwZTljYTBlMjIxZTk3NWNjMGY2YTM3NTZlZTk4YzZhYmVlYmJmY2E1ZWQ2NzA3MWQwYzRmNWQzOTE4ZDY5ZWQyMDgzMTkwYTkxOGZkOGY0YmIzZjU2YTBmYjZmNjcwMTFhZWNhMTcxOGViMjkxYjAwNTNmZjhlZjc4NGZlYjY2M2I3ZDA0ZjFmOTRkNzU1MDFiODM0NDkyNTExZDgzZjU2ZDg2ZWU5ZDdmMDQ5ODJhMzQ1YTA1NWRmNmY3OTUyNjhmMjI1ZDcwZjZkNzNkYzVhZjAyMDAwM2I0ZTdhNzNlMDczNjdiOTJhNTgxZWM5OWI4ODlmM2VmZjE1YjhhN2I1NDNkODVjYTZkZmRkYWFjYzVlMjAzMTdkMGVjNzkzNjljOTI5ZTg0NTExZmU5YmMxZmU4MDJhNDBjOGIzZWYxNGFjNGViNDE3NjFiNWQwZmMxOTJlYmYzOGQzZWEwZTBhNWU4NjM1YmQ3ZmVkM2YzMDUyOWM0OTgwMzA3MjM5ZTNjNTE1YmJkMWMyMGM0MWJjNDY2NDI3NGIyZDk2YjY0MjEwOTJmNTM5MTVlNDFjZmEwYjZkZTZhNjI1MTFlZGEzYzM5ZDIyMTA5MDE1YmRiYjZjZWQ3YTg1OGIyNzZiYWE4ZTJjYjFkYTExNmYxM2FmZTA2NGRmYTMyZjNhZmFmNmQ1MTJlM2Y5NmEyZmRkYTU2ZjRiZDcyMTJhYjJmYTExYTBlMGFkOWU5NTdlNTQ2NzY0OTJkNGQyMjhlNzkxZWRkOGYzYTBlN2M5YmU5MjhhMjgzMDM2NTQ5ZWE4MDM2YWRiZWUxNzZlZjFhOTM1MzFmNWYyZjMwM2Q0MjA3Mjc4MDc2NTFlYzZiNmQwYmJjYTYwMTMzZjQ0NzI0ZDcyNjg1NTcyZWU0MThlZGU5Yzk1ZDE0MTk4NTQ0MmEwZWFlODNhN2NkN2Q4MGM0NTU1Y2ZhYWY2OWU4YWI2YWM2NDc0MmIzNTRhZTBjNTg2ZTVjMzEzNDU2YmY5N2NiYjc2NWFiOWE4MjlhOWQxYWZmZTkzMWYwMmU2YzE0NjBjZjcyOTkzZTRhNjJkYjViN2UzZmFmNDM4MTIwNjcxMDkwY2UwYmI5NDAzOTE1YTQ3YTAyYTJiOTc5NWFmNTk2NDRlN2Q4Zjc2OTZhMDJkYTNhMThlMmRhOTQyYWIwNTQ2Yzg1ZjNiMzU0YWRhNDYzZTFmMzJkZWY4MzYyMzdiYzhmM2M3MjFhMWU4NjE2OWFiZWRhN2E2OWE2OTZhYmM4YmVlMjY3ZTgiLCJzYWx0IjoiMjc2NmM5ZDNiODI5OTdmYzMzNDkyOGY1YzU3OTk3NzMwNmNhNDAxOGI1MjljMTQzMTdiMmZkZWU0Njg4MjVmMSIsImNyZWF0ZWRBdCI6IjIwMTYtMDktMjVUMTY6MTg6MDQuMzYwWiIsInVwZGF0ZWRBdCI6IjIwMTYtMDktMjVUMTY6MTg6MDQuNDAxWiIsIl9pZCI6IjU3ZTdmOGJiN2QyOGVhMTgzZjljZjQ5ZiJ9LCJfcHJlcyI6eyIkX19vcmlnaW5hbF9zYXZlIjpbbnVsbCxudWxsLG51bGwsbnVsbF0sIiRfX29yaWdpbmFsX3ZhbGlkYXRlIjpbbnVsbF0sIiRfX29yaWdpbmFsX3JlbW92ZSI6W251bGxdfSwiX3Bvc3RzIjp7IiRfX29yaWdpbmFsX3NhdmUiOltdLCIkX19vcmlnaW5hbF92YWxpZGF0ZSI6W10sIiRfX29yaWdpbmFsX3JlbW92ZSI6W119LCJpYXQiOjE0NzQ4MjEyNDUsImV4cCI6MTQ3NDgyNDg0NX0.lAhUa5HLQDygWiJ9XAj0hu29tPzCOgNYbdq7siezkrA
 */